<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OnlyOffice Document Editor</title>
    <script src="http://localhost:8000/web-apps/apps/api/documents/api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.23/jsrsasign-all-min.js"></script>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; }
        #editor { height: 100vh; }
    </style>
</head>
<body>

<!-- Optional: Show patient info -->
<div style="padding: 10px; background: #f9f9f9;">
    <strong>Patient:</strong> <span th:text="${patient.pName}"></span>,
    <strong>Age:</strong> <span th:text="${patient.dob}"></span>,
    <strong>Gender:</strong> <span th:text="${patient.sex}"></span>
</div>

<div id="editor"></div>

<script th:inline="javascript">
    const fileName = /*[[${fileName}]]*/ 'blank.docx';
    const fileType = fileName.split('.').pop().toLowerCase();
    const fileKey = btoa(fileName);
    const secret = "m4y8q9NljJXqWu1VYbG3rD1sHZ0vCkX2FLMfRNQhWSo=";

    const config = {
        width: "100%",
        height: "100%",
        documentType: "word",
        document: {
            title: fileName,
            url: "http://host.docker.internal:8080/files/" + fileName,
            fileType: fileType,
            key: fileKey
        },
        editorConfig: {
            mode: "edit",
            callbackUrl: "http://host.docker.internal:8080/files/save-callback",
            permissions: {
                edit: true,
                download: true,
                print: true,
                review: true,
                comment: true,
                copy: true,
                fillForms: true,
                modifyFilter: true,
                modifyContentControl: true
            }
        }
    };

    // Sign token
    const header = { alg: "HS256", typ: "JWT" };
    const token = KJUR.jws.JWS.sign(null, JSON.stringify(header), JSON.stringify(config), secret);
    config.token = token;

    // Launch editor
    const docEditor = new DocsAPI.DocEditor("editor", config);
</script>

</body>
</html>
